<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA EM MANUTENÇÃO</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --bg: #050505; --text: #1a1a1a; } /* Cores foscas para parecer erro */

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); overflow: hidden;
            font-family: sans-serif; color: var(--text);
        }

        /* TELA DE ENGANO (DECOY) */
        #decoy-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 1000; background: var(--bg);
        }

        .spinner {
            width: 20px; height: 20px; border: 2px solid #111;
            border-top: 2px solid #222; border-radius: 50%;
            animation: spin 4s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* CONTAINER DE MÍDIA SUPREME */
        #media-container {
            display: none; position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh; z-index: 500;
            background: #000;
        }

        iframe, video {
            width: 100%; height: 100%; border: none;
            object-fit: contain; /* Garante que a imagem não estique errado */
        }

        /* GATILHOS INVISÍVEIS */
        #trigger-auth { /* Canto Inferior Direito - Senha */
            position: fixed; bottom: 0; right: 0;
            width: 60px; height: 60px; z-index: 2000; cursor: default;
        }

        #trigger-audio { /* Canto Inferior Esquerdo - Som */
            position: fixed; bottom: 0; left: 0;
            width: 60px; height: 60px; z-index: 2000; cursor: default;
        }

        /* MODAL DE SENHA MINIMALISTA */
        #gate {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: #000; border: 1px solid #111;
            padding: 15px; z-index: 3000;
        }

        input {
            background: #000; border: 1px solid #222;
            color: #444; padding: 8px; outline: none;
            font-family: monospace; text-align: center;
        }
    </style>
</head>
<body>

    <!-- CAMADA FAKE -->
    <div id="decoy-layer">
        <div class="spinner"></div>
        <p style="font-size: 10px; margin-top: 10px;">Connecting to Kernel v13.5...</p>
    </div>

    <!-- CONTAINER REAL -->
    <div id="media-container">
        <iframe id="viewer" src="" allow="autoplay; encrypted-media; fullscreen"></iframe>
    </div>

    <!-- GATILHOS -->
    <div id="trigger-auth" onclick="openGate()"></div>
    <div id="trigger-audio" onclick="enableAudio()"></div>

    <!-- PORTAL -->
    <div id="gate">
        <input type="password" id="pass" placeholder="CODE">
    </div>

<script>
    // CONFIGURAÇÃO FIREBASE (ESTRUTURA JDP)
    const firebaseConfig = {
        apiKey: "AIzaSyAu1hJH84fhY7GGbmzzdVyEkvYriaiOr_k",
        authDomain: "jdp-supreme-kernel.firebaseapp.com",
        databaseURL: "https://jdp-supreme-kernel-default-rtdb.firebaseio.com",
        projectId: "jdp-supreme-kernel",
        storageBucket: "jdp-supreme-kernel.firebasestorage.app",
        messagingSenderId: "709947760059",
        appId: "1:709947760059:web:1779bedd06e3957b34789e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // AUTO-IDENTIFICAÇÃO PELO NOME DO ARQUIVO
    const screenId = window.location.pathname.match(/\((\d+)\)/) ? window.location.pathname.match(/\((\d+)\)/)[1] : "1";

    function openGate() {
        document.getElementById('gate').style.display = 'block';
        document.getElementById('pass').focus();
    }

    document.getElementById('pass').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            if (this.value === '1234') { // SENHA DO SR. JOSÉ
                unlock();
            } else {
                this.value = '';
                document.getElementById('gate').style.display = 'none';
            }
        }
    });

    function unlock() {
        document.getElementById('decoy-layer').style.display = 'none';
        document.getElementById('gate').style.display = 'none';
        document.getElementById('media-container').style.display = 'block';
        startSync();
    }

    function enableAudio() {
        // Recarrega o frame com permissão de áudio ativa após clique do usuário
        const frame = document.getElementById('viewer');
        const currentSrc = frame.src;
        frame.src = currentSrc; 
        console.log("Áudio sincronizado pelo operador.");
    }

    function startSync() {
        db.ref('screens/' + screenId).on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.currentMedia) {
                const viewer = document.getElementById('viewer');
                // Só atualiza se a URL for diferente para evitar flicker (piscar)
                if(viewer.src !== data.currentMedia) {
                    viewer.src = data.currentMedia;
                }
            }
        });
    }

    // HEARTBEAT (ROBÔS DE FUNDO)
    setInterval(() => {
        db.ref('screens/' + screenId + '/lastSeen').set(Date.now());
    }, 10000);

    // ANTI-TRAVAMENTO: Verifica se o iframe está respondendo
    setInterval(() => {
        const viewer = document.getElementById('viewer');
        if(viewer.src === "") return;
        // Lógica interna de refresh silencioso pode ser adicionada aqui
    }, 60000);

</script>
</body>
</html>
